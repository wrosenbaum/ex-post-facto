<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Will  Rosenbaum | Lab 01: Estimating Pi</title>
<meta name="description" content="A blog about mathematics, computer science, etc.
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">



<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->
<link rel="shortcut icon" href="/assets/img/favicon.ico">
<link rel="stylesheet" href="/assets/css/main.css">

<link rel="canonical" href="/teaching/2021s-cosc-273/labs/01-estimating-pi/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

  <script src="/assets/js/theme.js"></script>
  <!-- Load DarkMode JS -->
<script src="/assets/js/dark_mode.js"></script>






    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="https://willrosenbaum.com/">
       Will   Rosenbaum
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/teaching/">
                teaching
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/research/">
                research
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                publications
                
              </a>
          </li>
          
          
	  
          <!-- Blog -->
          <li class="nav-item ">
            <a class="nav-link" href="/blog/">
              blog
              
            </a>
          </li>
          

          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      <div class="post">

  <header class="post-header">
    <h1 class="post-title">Lab 01: Estimating Pi</h1>
    <p class="post-description">estimating pi using a Monte Carlo simulation</p>
  </header>

  <article>
    <hr />

<p><strong>DUE:</strong> Friday, February 26, 23:59 <a href="https://time.is/Anywhere_on_Earth">AOE</a></p>

<hr />

<h4 id="prerequisites">Prerequisites</h4>

<ul>
  <li>Read <a href="/teaching/2021s-cosc-273/notes/multithreading">Multithreading</a></li>
  <li>Read <a href="/teaching/2021s-cosc-273/notes/monte-carlo-method">Monte Carlo Simulation</a></li>
</ul>

<h4 id="program-description">Program Description</h4>

<p>In this assignment, you will implement a multithreaded program that performs a Monte Carlo simulation to estimate the mathematical constant \(\pi \approx 3.14\ldots\). A conceptual description of such a procedure is described in the notes <a href="/teaching/2021s-cosc-273/notes/monte-carlo-method">Monte Carlo Simulation</a>. Briefly, the idea of the procedure is to generate many random sample points (i.e., pairs of numbers) lying inside a square, and return the number of samples that lie inside a disk inscribed in the square. Then \(\pi\) can be estimated from the proportion of samples that fall in the disk.</p>

<p>Your program should take two parameters—the number of samples, and the number of threads—and compute an estimate of \(\pi\) by performing the specified number of samples evenly distributed across the threads. For example, if the number samples is <code class="language-plaintext highlighter-rouge">1000</code>, and the number of threads is <code class="language-plaintext highlighter-rouge">10</code>, each thread should perform <code class="language-plaintext highlighter-rouge">1000 / 10 = 100</code> samples (you may assume that the number of samples is evenly divisible by the number of threads).</p>

<p>Specifically, your program must define a <code class="language-plaintext highlighter-rouge">PiEstimator</code> class that stores the number of samples and the number of threads used for its calculations. Be sure to use <code class="language-plaintext highlighter-rouge">long</code> for the number of samples, as this number could be larger than the maximum <code class="language-plaintext highlighter-rouge">int</code> value (which is a little over 2 billion). The <code class="language-plaintext highlighter-rouge">PiEstimator</code> class must include a public instance method <code class="language-plaintext highlighter-rouge">double getPiEstimate()</code> that returns the desired estimate of \(\pi\). For example, here is a skeleton of the <code class="language-plaintext highlighter-rouge">PiEstimator</code> class to get you started:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
  * Description: &lt;describe your program here&gt;
  *
  * @author &lt;your name here&gt;
  */</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PiEstimator</span> <span class="o">{</span>
    <span class="c1">// add any desired fields here</span>

    <span class="c1">// constructor taking in the number of sample points, numPoints, </span>
    <span class="c1">// and the number of threads used to compute the estimate</span>
    <span class="kd">public</span> <span class="nf">PiEstimator</span> <span class="o">(</span><span class="kt">long</span> <span class="n">numPoints</span><span class="o">,</span> <span class="kt">int</span> <span class="n">numThreads</span><span class="o">)</span> <span class="o">{</span>
	    <span class="o">...</span>
    <span class="o">}</span>

    <span class="c1">// compute the estimate of pi (improve this description!)</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getPiEstimate</span> <span class="o">()</span> <span class="o">{</span>
	    <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>In order to make your program multithreaded, you will need to write a separate class that implements the <code class="language-plaintext highlighter-rouge">Runnable</code> interface. For example, you might define a class <code class="language-plaintext highlighter-rouge">PiThread</code> as follows in a separate file.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PiThread</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Each instance of <code class="language-plaintext highlighter-rouge">PiThread</code> can then perform a prescribed number of samples, and record the number of samples falling within a disk in an appropriate location of a shared array. See the notes on <a href="/teaching/2021s-cosc-273/notes/multithreading">Multithreading</a> for an example of how to define and use threads that modify a shared array.</p>

<h5 id="testing-your-program">Testing Your Program</h5>

<p>To test your program, <a href="/assets/java/2021s-cosc-273/lab01-estimating-pi/PiTester.java">download and run <code class="language-plaintext highlighter-rouge">PiTester.java</code></a>, reproduced below.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PiTester</span> <span class="o">{</span>
    <span class="c1">// powers of two that are close to powers of 10</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="no">THOUSAND</span> <span class="o">=</span> <span class="mi">1_024</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="no">MILLION</span> <span class="o">=</span> <span class="mi">1_048_576</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="no">BILLION</span> <span class="o">=</span> <span class="mi">1_073_741_824</span><span class="o">;</span>

    
    <span class="c1">// array of thread counts to test performance</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span><span class="o">[]</span> <span class="no">THREAD_COUNTS</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="mi">32</span><span class="o">,</span> <span class="mi">64</span><span class="o">,</span> <span class="mi">128</span><span class="o">,</span> <span class="mi">256</span><span class="o">};</span>

    <span class="c1">// the total number of samples to be collected</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="no">NUM_POINTS</span> <span class="o">=</span> <span class="no">BILLION</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span> <span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Running Monte Carlo simulation with n = "</span> <span class="o">+</span> <span class="no">NUM_POINTS</span> <span class="o">+</span> <span class="s">" samples...\n"</span><span class="o">);</span>
	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span> <span class="s">"n threads | pi estimate | time (ms)\n"</span>
			   <span class="o">+</span><span class="s">"-----------------------------------"</span><span class="o">);</span>

	<span class="c1">// start and end times of computation</span>
	<span class="kt">long</span> <span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">;</span>

	<span class="c1">// test</span>
	<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">:</span> <span class="no">THREAD_COUNTS</span><span class="o">)</span> <span class="o">{</span>
	    
	    <span class="nc">PiEstimator</span> <span class="n">pe</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PiEstimator</span><span class="o">(</span><span class="no">NUM_POINTS</span><span class="o">,</span> <span class="n">n</span><span class="o">);</span>
	    
	    <span class="n">start</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
	    
	    <span class="kt">double</span> <span class="n">est</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="na">getPiEstimate</span><span class="o">();</span>
	    
	    <span class="n">end</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>

	    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%9d |     %.5f | %6d\n"</span><span class="o">,</span> <span class="n">n</span><span class="o">,</span> <span class="n">est</span><span class="o">,</span> <span class="o">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="o">)</span> <span class="o">/</span> <span class="mi">1_000_000</span><span class="o">);</span>    
	<span class="o">}</span>

	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"-----------------------------------"</span><span class="o">);</span>
    <span class="o">}</span>	
<span class="o">}</span>

</code></pre></div></div>

<p>When I run the <code class="language-plaintext highlighter-rouge">PiTester</code> program on my computer, I get the following output (which takes a while to produce):</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>% java PiTester
Running Monte Carlo simulation with n = 1073741824 samples...

n threads | pi estimate | time (ms)
-----------------------------------
        1 |     3.14158 |   8174
        2 |     3.14161 |   4690
        4 |     3.14161 |   2709
        8 |     3.14163 |   1735
       16 |     3.14156 |   1867
       32 |     3.14167 |   1938
       64 |     3.14156 |   1905
      128 |     3.14157 |   1907
      256 |     3.14164 |   1919
-----------------------------------
</code></pre></div></div>

<p>Note that the third column indicates the time needed to run approximately 1 billion samples.</p>

<h4 id="hints-and-resources">Hints and Resources</h4>

<p>In performing the Monte Carlo simulation, each thread must compute many random samples. In single-threaded programs, you would typically generate (pseudo)random numbers using <code class="language-plaintext highlighter-rouge">java.util.Random</code>, and using a method such as <code class="language-plaintext highlighter-rouge">nextDouble()</code>. Unfortunately, <code class="language-plaintext highlighter-rouge">java.util.Random</code> does not play well with multithreaded programs. Instead, your program should use a “thread local” random number generator so that each thread has its own independent stream of random numbers. Thankfully, Java has a built-in thread local generator, <code class="language-plaintext highlighter-rouge">ThreadLocalRandom</code> (see <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/ThreadLocalRandom.html">documentation here</a>). To use <code class="language-plaintext highlighter-rouge">ThreadLocalRandom</code>, you need to include it at the beginning of your program with</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadLocalRandom</span><span class="o">;</span>
</code></pre></div></div>

<p>Then to get, for example, a random <code class="language-plaintext highlighter-rouge">double</code>, you can use</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">nextDouble</span><span class="o">()</span>
</code></pre></div></div>

<p>Note that <code class="language-plaintext highlighter-rouge">current()</code> is a static method that returns a <code class="language-plaintext highlighter-rouge">ThreadLocalRandom</code> object specific to the current thread.</p>

<h4 id="what-to-turn-in">What to Turn In</h4>

<p>Please submit your program files to the Moodle submission site by <strong>Friday, February 26, 23:59 <a href="https://time.is/Anywhere_on_Earth">AOE</a></strong>. Be sure to submit everything your program needs to run: at minimum <code class="language-plaintext highlighter-rouge">PiEstimator.java</code> and <code class="language-plaintext highlighter-rouge">PiThread.java</code> (assuming you’ve put the <code class="language-plaintext highlighter-rouge">PiThread</code> class in a separate file).</p>

<p>Also, please complete <a href="https://forms.gle/PsD2B9ZLL6SCUB6aA">this survey</a> to tell me about your experience with this lab.</p>

<h4 id="grading">Grading</h4>

<p>Your programs will be graded on a 5 point scale according to the following criteria:</p>

<ul>
  <li>
    <p><strong>Correctness</strong> (2 pts). Your program compiles and completes the task as specified in the program description above.</p>
  </li>
  <li>
    <p><strong>Style</strong> (1 pt). Code is reasonably well-organized and readable (to a human). Variables, methods, and classes  have sensible, descriptive names. Code is well-commented.</p>
  </li>
  <li>
    <p><strong>Performance</strong> (2 pts). Code performance is comparable to the instructor’s implementation. Program shows a significant improvement in performance with multiple threads.</p>
  </li>
</ul>

<h4 id="extensions">Extensions</h4>

<p>As mentioned in the notes on <a href="/teaching/2021s-cosc-273/notes/monte-carlo-method">Monte Carlo Simulation</a>, there are many more applications of Monte Carlo simulation. For a relatively simple application, <a href="https://doi.org/10.2307/2685243">this paper</a> describes a method for estimating Euler’s number, \(e = 2.718\ldots\). (If you are off campus, you can access the full text by using the Amherst College proxy, or by searching for the article through the library website.)</p>


  </article>

</div>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    &copy; Copyright 2021 Will  Rosenbaum.
    
    
    
  </div>
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
